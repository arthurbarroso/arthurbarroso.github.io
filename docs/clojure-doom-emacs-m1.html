<html lang="en" xml.lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta charset="utf-8" /><meta content="Setting up Clojure and Doom Emacs on M1-powered computers." name="description" /><meta content="KLXtbzGXgE_BcqGEwJv7vCVH6-XMLskVDgd-rRVoZHg" name="google-site-verification" /><meta content="https://www.arthurbrrs.me/img/collage/publicint.png" property="og:image" /><meta content="clojure" name="keywords" /><meta content="width=device-width, initial-scale=1" name="viewport" /><meta content="clojure m1 clj-kondo clojure-lsp emacs doom emacs parinfer" name="keywords" /><meta content="Setting up Clojure and Doom Emacs on M1-powered computers." name="description" /><meta content="Setting up Clojure and Doom Emacs on M1-powered computers." property="og:description" /><meta content="https://arthurbrrs.me/clojure-doom-emacs-m1.html" property="og:url" /><meta content="Clojure and Doom Emacs on a brand new M1 computer" property="og:title" /><meta content="article" property="og:type" /><meta content="https://www.arthurbrrs.me/img/collage/publicint.png" property="og:image" /><link href="https://arthurbrrs.me/clojure-doom-emacs-m1" rel="canonical" /><link href="css/favicon.ico" rel="shortcut icon" /><link href="https://fonts.googleapis.com" rel="preconnect" /><link crossorigin="crossorigin" href="https://fonts.gstatic.com" rel="preconnect" /><link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;0,900;1,700&amp;display=swap" rel="stylesheet" /><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/github.min.css" rel="stylesheet" /><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js"></script><link href="/css/screen.css" rel="stylesheet" /><title>((arthur barroso)): Clojure and Doom Emacs on a brand new M1 computer</title></head><body><nav class="navbar"><div class="container"><div class="navbar-header"><a class="navbar-title" href="/">((arthur barroso))</a><ul class="navbar-list"><li><a class="navbar-link" href="/archives">archives</a><a class="navbar-link" href="/collage">collage</a><a class="navbar-link" href="/about">about</a></li></ul></div></div></nav><div class="container"><div class="row"><div><div id="content"><div id="post"><div class="post-header"><div class="row" id="post-meta"><div class="col-lg-6">2022-04-17</div></div><h2>Clojure and Doom Emacs on a brand new M1 computer</h2><div><p>I've recently landed my first Clojure position and received an m1-powered MacBook. Two months before that, I had also bought myself an m1 MacBook air and had to set up Clojure to use it in my projects. Since I had no experience using macOS whatsoever I had to do some googling and managed to get a pretty simple setup running.</p><p>There are lots of tutorials out there on how to set up m1 laptops for Clojure usage, but there are a few quirks that aren't yet documented, such as how to get <code>clj-kondo</code> and <code>parinfer</code> to work in it. I'll try to cover these steps in this post, while also showing how to set up doom emacs and some other stuff I ended up using myself.</p><p>Let's get to it:</p><h2>Table of contents:</h2><ol><li><a href='#java'>Installing Java and Clojure</a></li><li><a href='#emacs'>Doom Emacs</a></li><li><a href='#kondo'>Clj-kondo</a></li><li><a href='#parinfer'>Parinfer-rust</a></li></ol><h3>Installing Java and Clojure <a name="java"></a></h3><p>This post will describe two ways of installing Java and Clojure: one will use <a href='https://brew.sh'>homebrew</a> and the other will install things manually.</p><h4>Using homebrew:</h4><p>We'll go the easy route here: we will use Homebrew to install Zulu (an m1 native version of the JVM), Clojure, Java, and Leiningen. To do so, we'll start by adding homebrew:</p><pre><code class="bash">/bin/bash -c &quot;$&#40;curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh&#41;&quot;
</code></pre><p>After installing, homebrew will ask us to add it to our PATH. We'll do so and move on to installing Java, Clojure, and Leiningen:<pre><code class="bash">arch -arm64 brew install zulu clojure/tools/clojure leiningen
</code></pre></p><p>With the above done, we'll now simply add our <code>JAVA&#95;HOME</code> to our PATH:<pre><code class="bash">export JAVA&#95;HOME=&quot;/Library/Java/JavaVirtualMachines/zulu-17.jdk/Contents/Home&quot;
</code></pre></p><p>To verify our setup, we can simply run <code>clojure</code> and open up a REPL.</p><h4>Manual installation:</h4><p>We will start by downloading Azul's Zulu m1 build from their <a href='https://www.azul.com/downloads/?version=java-17-lts&os=macos&architecture=arm-64-bit&package=jdk'>downloads page</a>. With the download done, we'll open the <code>zip</code> file and copy the <code>zulu-17.jdk</code> folder to <code>/Library/Java/JavaVirtualMachines/</code>. We'll also set the <code>JAVA&#95;HOME</code> variable:<pre><code class="bash">export JAVA&#95;HOME=&quot;/Library/Java/JavaVirtualMachines/zulu-17.jdk/Contents/Home&quot;
</code></pre></p><p>With <code>JAVA&#95;HOME</code> set up, it is time to install Leiningen, which will also install Clojure. To do so, we'll simply follow <a href='https://leiningen.org/'>Leiningen's instructions</a>.</p><p>With the above done, we can now verify our setup by running <code>clojure</code>.</p><h3>Doom Emacs <a name="emacs"></a></h3><p>My editor of choice is Doom Emacs. To use it, we'll need to first download emacs. This will be done using homebrew:<pre><code class="bash">brew tap railwaycat/emacsmacport
brew install --cask emacs-mac
</code></pre></p><p>With the step above done, we'll now move into getting <a href='https://github.com/hlissner/doom-emacs'>Doom Emacs</a>:<pre><code class="bash">git clone --depth 1 https://github.com/hlissner/doom-emacs &#126;/.emacs.d
&#126;/.emacs.d/bin/doom install
</code></pre></p><p>Lets now configure it so we can use tools such as CIDER and clojure-lsp. This can be done by changing the <code>.doom.d/init.el</code> file. We'll start by uncommenting <code>lsp</code>, and <code>clojure</code> (under <code>:lang</code>). We will also want to add <code>+lsp</code> to that <code>clojure</code> expression, making it <code>&#40;clojure +lsp&#41;</code>. Having done that, we'll run <code>&#126;/.emacs.d/bin/doom sync</code> and our pretty basic Clojure environment will be set up.</p><h3>Clj-kondo <a name="kondo"></a></h3><p>Adding <code>+lsp</code> to <code>clojure</code> in <code>init.el</code> made doom add <code>clojure-lsp</code> to our emacs configuration. Clojure-LSP comes with <code>clj-kondo</code>, but, for some reason I do not know, <code>flycheck</code> won't recognize it, so we'll probably also want to install kondo as a separate executable. To do so, we'll need to install GraalVM.</p><p>Setting up GraalVM on an m1 device currently requires using a snapshot, so we'll simply use it. Follow <a href='https://github.com/oracle/graal/issues/2666#issuecomment-1074884020'>this comment</a> to get it up and running. (The file you should download is <code>graalvm-ce-java17-darwin-aarch64-dev.tar.gz</code>). After setting up, also add the <code>GRAALVM&#95;HOME</code> variable to <code>PATH</code> -it should match the value for the <code>JAVA&#95;HOME</code> for Graal.</p><p>We can now compile and install clj-kondo on an m1 device:<pre><code class="bash">git clone https://github.com/clj-kondo/clj-kondo.git
cd clj-kondo
script/compile
</code></pre></p><p>Now simply add it to your PATH and you'll be able to use <code>clj-kondo</code> in <code>flycheck</code>.</p><h3>Parinfer-rust <a name="parinfer"></a></h3><p>There is currently no releases of <code>parinfer-rust</code> for m1 devices. This means we need to compile it ourselves. We'll need to <a href='https://www.rust-lang.org/tools/install'>install rust</a>:<pre><code class="bash">curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source $HOME/.cargo/env
</code></pre></p><p>We'll then move into compiling parinfer-rust:<pre><code class="bash">git clone https://github.com/eraserhd/parinfer-rust.git
cd parinfer-rust
cargo build --release --features emacs
</code></pre></p><p>After compiling it, we'll move it to emacs:<pre><code class="bash">mkdir &#126;/.emacs.d/.local/etc/parinfer-rust
mv target/release/libparinfer&#95;rust.dylib &#126;/.emacs.d/.local/etc/parinfer-rust/parinfer-rust-darwin.so
</code></pre></p><p>We'll activate parinfer on our doom config by uncommenting <code>parinfer</code> in <code>&#126;/.doom.d/init.el</code> and adding <code>&#40;use-package! parinfer-rust-mode&#41;</code> to our <code>&#126;/.doom.d/packages.el</code> file and run <code>&#126;/.emacs.d/bin/doom sync</code> </p><p>And that's pretty much it for a basic setup :) Hope someone finds this useful</p></div></div></div></div></div></div><footer>Copyright &copy; 2022 Arthur Barroso</footer></div></body><script src="/js/clojure_highlighter.js"></script><script>document.addEventListener('DOMContentLoaded', (event) => {
      document.querySelectorAll('pre code:not(.clj)').forEach((el) => {
          hljs.highlightElement(el);
      });
     });</script></html>